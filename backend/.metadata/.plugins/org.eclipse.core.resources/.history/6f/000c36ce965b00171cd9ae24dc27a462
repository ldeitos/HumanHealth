package br.com.humanhealth.persistence.impl.interceptor;

import javax.interceptor.AroundInvoke;
import javax.interceptor.Interceptor;
import javax.interceptor.InvocationContext;

import br.com.humanhealth.persistence.Transactional;

@Interceptor
@Transactional
public class TransactionalInterceptor {
    
    @AroundInvoke
    public Object doTransaction(InvocationContext ix) throws Exception{
	Object toReturn = null;

	Objectfofy().transact(new VoidWork() {
	    public void vrun() {
	        Thing thing = ofy().load().key(thingKey).get();
	        Other other = ofy().transactionless().load().key(thing.otherKey).now();
	        if (other.specialState) {
	            thing.modify();
	            ofy().save().entity(thing);
	        }
	    }
	});
	
	return toReturn;
	
    }

}
