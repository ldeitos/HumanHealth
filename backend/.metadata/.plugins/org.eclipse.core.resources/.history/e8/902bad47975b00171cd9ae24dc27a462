package br.com.humanhealth.persistence.interceptor;

import javax.interceptor.Interceptor;
import javax.interceptor.InvocationContext;

import com.googlecode.objectify.ObjectifyService;
import com.googlecode.objectify.VoidWork;

import br.com.humanhealth.persistence.Transactional;

@Interceptor
@Transactional
public class TransactionalInterceptor {

    public Object doTransact(InvocationContext ic) throws Exception {
	final Object toReturn;
	
	ObjectifyService.ofy().transact(new VoidWork() {
	    @Override
	    public void vrun() {
		toReturn = ic.proceed();		
	    }
	});
	
	return toReturn;
    }
}
